"use strict";var _createClass=function(){function n(n,i){for(var e=0;e<i.length;e++){var t=i[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(n,t.key,t)}}return function(i,e,t){return e&&n(i.prototype,e),t&&n(i,t),i}}();function _classCallCheck(n,i){if(!(n instanceof i))throw new TypeError("Cannot call a class as a function")}define(["jquery","mod_swiftquiz/core"],function(n,i){var e=i.Quiz,t=i.Question,o=i.Ajax,u=i.setText,s=function(){function i(e){_classCallCheck(this,i),this.quiz=e,this.voteAnswer=void 0;var t=this;n(document).on("submit","#swiftquiz_question_form",function(n){n.preventDefault(),t.submitAnswer()}).on("click","#swiftquiz_save_vote",function(){t.saveVote()}).on("click",".swiftquiz-select-vote",function(){t.voteAnswer=this.value})}return _createClass(i,[{key:"onNotRunning",value:function(n){u(e.info,"instructions_for_student")}},{key:"onPreparing",value:function(n){u(e.info,"wait_for_instructor")}},{key:"onRunning",value:function(n){this.quiz.question.isRunning||(this.quiz.question.startCountdown(n.questiontime,n.delay)||u(e.info,"wait_for_instructor"))}},{key:"onReviewing",value:function(n){this.quiz.question.isVoteRunning=!1,this.quiz.question.isRunning=!1,this.quiz.question.hideTimer(),e.hide(t.box),u(e.info,"wait_for_instructor")}},{key:"onSessionClosed",value:function(n){window.location=location.href.split("&")[0]}},{key:"onVoting",value:function(i){if(!this.quiz.question.isVoteRunning){e.info.html(i.html),e.show(e.info);for(var t=i.options,o=0;o<t.length;o++)e.addMathjaxElement(n("#"+t[o].content_id),t[o].text),"stack"===t[o].question_type&&e.renderMaximaEquation(t[o].text,t[o].content_id);this.quiz.question.isVoteRunning=!0}}},{key:"onStateChange",value:function(n){}},{key:"onQuestionTimerEnding",value:function(){}},{key:"onTimerTick",value:function(n){u(t.timer,"question_will_end_in_x_seconds","swiftquiz",n)}},{key:"onQuestionRefreshed",value:function(n){}},{key:"submitAnswer",value:function(){var n=this;if(!this.quiz.question.isSaving){this.quiz.question.isSaving=!0,"undefined"!=typeof tinyMCE&&tinyMCE.triggerSave();var i=t.form.serializeArray(),s={};for(var a in i)i.hasOwnProperty(a)&&(s[i[a].name]=i[a].value);o.post("save_question",s,function(i){i.feedback.length>0?e.show(e.info.html(i.feedback)):u(e.info,"wait_for_instructor"),n.quiz.question.isSaving=!1,n.quiz.question.isRunning&&(n.quiz.question.isVoteRunning||(e.hide(t.box),n.quiz.question.hideTimer()))}).fail(function(){n.quiz.question.isSaving=!1})}}},{key:"saveVote",value:function(){o.post("save_vote",{vote:this.voteAnswer},function(n){"success"===n.status?u(e.info,"wait_for_instructor"):u(e.info,"you_already_voted")})}}]),i}();return{initialize:function(){new e(s).poll(2e3)}}});